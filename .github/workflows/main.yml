name: espidf CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v2
      with:
        submodules: 'recursive'

    - name: Create build container
      run: |
        cp .gitpod.Dockerfile ghdf
        sed -i 's/gitpod.workspace.full/ubuntu:20.04/' ghdf
        sed -i 's/USER gitpod//' ghdf
        echo 'CMD ["/bin/bash"]' >> ghdf
        docker build -t local - < ghdf
        rm ghdf

    - name: Build
      run: docker run -it -v $PWD:/srv -w/srv local idf.py build
