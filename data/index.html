<!doctype html>
<html>
    <head>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" />
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" crossorigin="anonymous"></script>
<style>
body {
    background-color: #eee
}

.sidenav {
          height: 100%;
          width: 160px;
          position: fixed;
          z-index: 1;
          top: 0;
          left: 0;
          background-color: #111;
          overflow-x: hidden;
          padding-top: 20px;
        }

.main {
margin-left: 100px; /* Same as the width of the sidenav */
  font-size: 28px; /* Increased text to enable scrolling */
  padding: 0px 10px;
}

.nav-link {
    border-radius: 0px !important;
    transition: all 0.5s;
    width: 100px;
    display: flex;
    flex-direction: column
}

.nav-link small {
    font-size: 12px
}

.nav-link:hover {
    background-color: #52525240 !important
}

.nav-link .fa {
    transition: all 1s;
    font-size: 20px
}

.btn-label {
    width: 78px !important;    
}

</style>
    </head>
<body>
<div class="sidenav d-flex flex-column flex-shrink-0 bg-light vh-100" style="width: 100px;">
    <ul class="nav nav-pills nav-flush flex-column mb-auto text-center">
        <li> <a href="#" class="nav-link py-3 border-bottom active"> <i class="fa fa-gamepad"></i> <small>Manual Control</small> </a> </li>
        <li> <a href="#" class="nav-link py-3 border-bottom"> <i class="fa fa-file"></i> <small>Robo Script</small> </a> </li>
        <li> <a href="#" class="nav-link py-3 border-bottom"> <i class="fa fa-cog"></i> <small>Settings</small> </a> </li>
        <li> <a href="#" class="nav-link py-3 border-bottom"> <i class="fa fa-stethoscope"></i> <small>Diagnosis</small> </a> </li>
    </ul>
</div>
<div id="main_manual" class="main">
    <button id="btn-home" type="button" class="btn-label btn btn-outline-primary">Home</button>
    <div class="btn-group-vertical">
        <button id="btn-a1-inc" type="button" class="btn btn-outline-primary">A1 +</button>
        <button id="btn-a2-inc" type="button" class="btn btn-outline-primary">A2 +</button>
        <button id="btn-a3-inc" type="button" class="btn btn-outline-primary">A3 +</button>
        <button id="btn-a4-inc" type="button" class="btn btn-outline-primary">Gripper Open</button>
      </div> 
      <div class="btn-group-vertical">
        <button id="btn-a1-dec" type="button" class="btn btn-outline-primary">A1 -</button>
        <button id="btn-a2-dec" type="button" class="btn btn-outline-primary">A2 -</button>
        <button id="btn-a3-dec" type="button" class="btn btn-outline-primary">A3 -</button>
        <button id="btn-a4-dec" type="button" class="btn btn-outline-primary">Gripper Close</button>
      </div>
      <div class="btn-group-vertical">
        <button id="pos-a1" type="button" class="btn-label btn btn-outline-primary disabled">0</button>
        <button id="pos-a2" type="button" class="btn-label btn btn-outline-primary disabled">0</button>
        <button id="pos-a3" type="button" class="btn-label btn btn-outline-primary disabled">0</button>
        <button id="pos-a4" type="button" class="btn-label btn btn-outline-primary disabled">0</button>
      </div>
</div>
<div id="main_lua" class="main">
    <div class="mb-3">
        <label for="luaScriptTextarea" class="form-label">Robo Script</label>
        <textarea class="form-control" id="luaScriptTextarea" rows="10"></textarea>
      </div>
    <button id="btn-run-lua" type="button" class="btn-label btn btn-outline-primary">Run</button>
    <button id="btn-run-save" type="button" class="btn-label btn btn-outline-primary">Save</button>
</div>

</body>
<script>
    function get_joint_angles_from_display() {
        var pos = [];
        for (var i = 0; i < 4; i++) {
            pos[i] = parseInt($("#pos-a" + (i+1)).text());
        }
        return pos;
    }

    function get_joint_angles_from_controller() {
        $.getJSON("/rest/get_joint_angles", function(data) {
            set_joint_angles_on_display(data);
        });
    }

    function set_joint_angles_on_display(angles) {
        for(var i = 0; i < angles.length; i++) {
                $("#pos-a" + (i+1)).text(angles[i]);
        }
    }

    function set_joint_angles_on_controller(angles) {
        $.ajax({
            type: "POST", 
            dataType: "json", 
            contentType: "application/json", 
            url: "/rest/set_joint_angles", 
            data: JSON.stringify(angles),
            success: function(data) {
                set_joint_angles_on_display(angles);
            }
        });
    }

    $(document).ready(function(){
        get_joint_angles_from_controller();
    });

    $('[id^="btn-a"]').click(function(){
        var id = $(this).attr('id');
        var axis = parseInt(id.match(/\d/)[0]);
        var direction = id.endsWith("inc") ? 1 : -1;
        var pos = get_joint_angles_from_display();
        pos[axis-1] += direction;
        set_joint_angles_on_controller(pos);
    });

    $('#btn-home').click(function(){
        var pos = [90,90,90,90];
        set_joint_angles_on_controller(pos);
    });

    $('#btn-run-lua').click(function(){
        $.ajax({
        type: "POST",
        url: "/rest/run_script",
        data: $("#luaScriptTextarea").val(),
        contentType: 'text/plain',
        success: function(data) {
            console.log(data);
        }
        })
    });
</script>
</html>
